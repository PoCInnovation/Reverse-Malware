const { getValueArg } = require("../../../ast_utils");
const { R6BG_YT } = require("../../../vars/encrypted_vars");
const { handleDefProxies } = require("../../proxy/proxy");

function defineDynamicIndexer(funcName, node, scope, declaration) {
    if (node.type === 'CallExpression') { // proxy def
        return handleDefProxies(funcName, node, scope, declaration);
    }
    let res;
    if (node.callee) { // value
        res = getValueArg(node);
        if (res == null)
            return;
    } else { // func callee
        const rawArg = node.property.right; //.arguments[0];
        res = getValueArg(rawArg);
        if (res == null)
            return;
        if (node.property.operator === '-')
            res = -res;
    }

    scope.setElementInScope(funcName, function(val) {
        return R6BG_YT[val + res];
    }, declaration);
}



module.exports = { defineDynamicIndexer };
